env:
  # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
  #   via the "travis encrypt" command using the project repo's public key
  # TODO: Replace the secure key below!
  global:
   - secure: "<put the real key here>"
  - LWS_METHOD=default
  - LWS_METHOD=noserver CMAKE_ARGS="-DLWS_WITHOUT_SERVER=ON"
  - LWS_METHOD=noclient CMAKE_ARGS="-DLWS_WITHOUT_CLIENT=ON"
  - LWS_METHOD=noext CMAKE_ARGS="-DLWS_WITHOUT_EXTENSIONS=ON"
  - LWS_METHOD=libev CMAKE_ARGS="-DLWS_WITH_LIBEV=ON"
  - LWS_METHOD=noipv6 CMAKE_ARGS="-DLWS_IPV6=OFF"
  - LWS_METHOD=http2 CMAKE_ARGS="-DLWS_WITH_HTTP2=ON"
  - LWS_METHOD=nossl CMAKE_ARGS="-DLWS_WITH_SSL=OFF"
  - LWS_METHOD=nodaemon CMAKE_ARGS="-DLWS_WITHOUT_DAEMONIZE=ON"
compiler:
  - gcc
  - clang
language: c
install:
  - sudo apt-get update -qq && sudo apt-get install -y -qq valgrind
  - if [ x$LWS_METHOD == xlibev ] && [ "$COVERITY_SCAN_BRANCH" != 1 ]; then sudo apt-get install -y -qq libev-dev; fi
script:
  - if [ "$COVERITY_SCAN_BRANCH" != 1 ]; then mkdir build && cd build && cmake $CMAKE_ARGS .. && cmake --build .; fi
addons:
  coverity_scan:
    project:
      name: "warmcat/libwebsockets"
      description: "This is the libwebsockets C library for lightweight websocket clients and servers."
    notification_email: andy.green@linaro.org
    build_command_prepend: "mkdir build && cd build && cmake .."
    build_command:   "cmake --build ."
    branch_pattern: coverity_scan
